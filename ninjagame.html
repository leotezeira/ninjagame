<!DOCTYPE html>

<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>ğŸ¥ Ninja RPG - Estilo Naruto</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <div class="game-container">
        <h1>ğŸ¥ NINJA RPG ğŸ¥</h1>
        <!-- ...existing code... -->
    </div>
    <!-- ============================================
     SISTEMA DE MODALES PERSONALIZADOS
     Reemplaza alert(), confirm() y prompt()
     ============================================ -->

    <!-- Modal: alert() personalizado -->
    <div id="modal-alert" style="position:fixed; inset:0; background:rgba(0,0,0,0.85); z-index:99999; display:none; align-items:center; justify-content:center; backdrop-filter:blur(4px);">
        <div style="background:var(--bg-panel); border:2px solid var(--accent-primary); border-radius:var(--radius-lg); padding:28px 24px; max-width:420px; width:90%; text-align:center; animation:modalSlideIn 0.25s ease-out;">
            <div id="modal-alert-icon" style="font-size:2em; margin-bottom:12px;">â„¹ï¸</div>
            <p id="modal-alert-message" style="color:var(--text-primary); font-size:1em; line-height:1.6; margin-bottom:20px; white-space:pre-line;"></p>
            <button id="modal-alert-ok" class="btn" style="min-width:120px;">Aceptar</button>
        </div>
    </div>

    <!-- Modal: confirm() personalizado -->
    <div id="modal-confirm" style="display:none; position:fixed; inset:0; background:rgba(0,0,0,0.85); z-index:99999; align-items:center; justify-content:center; backdrop-filter:blur(4px);">
        <div style="background:var(--bg-panel); border:2px solid var(--accent-primary); border-radius:var(--radius-lg); padding:28px 24px; max-width:460px; width:90%; text-align:center; animation:modalSlideIn 0.25s ease-out;">
            <div id="modal-confirm-icon" style="font-size:2em; margin-bottom:12px;">â“</div>
            <p id="modal-confirm-message" style="color:var(--text-primary); font-size:1em; line-height:1.6; margin-bottom:20px; white-space:pre-line;"></p>
            <div style="display:flex; gap:12px; justify-content:center;">
                <button id="modal-confirm-yes" class="btn" style="min-width:120px;">Confirmar</button>
                <button id="modal-confirm-no" class="btn btn-secondary" style="min-width:120px;">Cancelar</button>
            </div>
        </div>
    </div>

    <!-- Modal: prompt() personalizado -->
    <div id="modal-prompt" style="display:none; position:fixed; inset:0; background:rgba(0,0,0,0.85); z-index:99999; align-items:center; justify-content:center; backdrop-filter:blur(4px);">
        <div style="background:var(--bg-panel); border:2px solid var(--accent-primary); border-radius:var(--radius-lg); padding:28px 24px; max-width:460px; width:90%; text-align:center; animation:modalSlideIn 0.25s ease-out;">
            <div id="modal-prompt-icon" style="font-size:2em; margin-bottom:12px;">âœï¸</div>
            <p id="modal-prompt-message" style="color:var(--text-primary); font-size:1em; line-height:1.6; margin-bottom:16px; white-space:pre-line;"></p>
            <input id="modal-prompt-input" class="text-input" type="text" style="width:100%; margin-bottom:16px;" />
            <div style="display:flex; gap:12px; justify-content:center;">
                <button id="modal-prompt-ok" class="btn" style="min-width:120px;">Aceptar</button>
                <button id="modal-prompt-cancel" class="btn btn-secondary" style="min-width:120px;">Cancelar</button>
            </div>
        </div>
    </div>

    <!-- Nombre del Ninja -->
    <div id="name-screen" class="screen">
        <div class="story-text">
            <h2>ğŸ¥· Crea tu Ninja</h2>
            <p id="name-screen-hint">Elige el nombre que sera recordado en el mundo ninja.</p>
        </div>
        <div class="player-info" style="max-width: 560px; margin: 0 auto; border-top: none;">
            <label for="player-name-input" style="display:block; margin-bottom: 12px; color:#ff8c00; font-weight: bold; text-transform: uppercase; font-size: 0.9em; letter-spacing: 0.5px;">Tu Nombre Ninja</label>
            <input id="player-name-input" class="text-input" type="text" maxlength="20" placeholder="Ej: Kenji Uzumaki..." autocomplete="off" />
            <div id="name-error" style="margin-top: 12px; color:#ff7f66; display: none;"></div>
            <div style="text-align:center; margin-top: 20px; display: flex; gap: 12px; justify-content: center;">
                <button class="btn" onclick="game.validateAndSaveName()">Continuar</button>
            </div>
        </div>
    </div>

    <!-- SelecciÃ³n de Clan -->
    <div id="clan-screen" class="screen">
        <div style="text-align: center; margin-bottom: 28px;">
            <div style="font-size: 3em; opacity: 0.15; margin-bottom: 8px;">å¿</div>
            <h2 style="color: #ff8c00; margin: 0; font-size: 1.3em;">Elige Tu Clan</h2>
        </div>
        <div class="clan-select" id="clan-select"></div>
    </div>

    <!-- SelecciÃ³n de Aldea -->
    <div id="village-select-screen" class="screen">
        <div style="text-align: center; margin-bottom: 28px;">
            <div style="font-size: 3em; opacity: 0.15; margin-bottom: 8px;">ğŸ˜ï¸</div>
            <h2 style="color: #ff8c00; margin: 0; font-size: 1.3em;">Elige Tu Aldea Natal</h2>
        </div>
        <div class="village-select" id="village-select"></div>
    </div>

    <!-- Sorteo de Kekkei Genkai -->
    <div id="kekkei-screen" class="screen">
        <div class="kekkei-genkai-notification" id="kekkei-result">
            <h2>ğŸŒŸ Realizando Sorteo de Kekkei Genkai... ğŸŒŸ</h2>
        </div>
        <div style="text-align: center; margin-top: 32px;">
            <button class="btn" id="kekkei-continue-btn" onclick="game.finishCharacterCreation()" disabled style="opacity: 0.4; cursor: not-allowed;">Continuar</button>
        </div>
    </div>

    <!-- Pantalla de Briefing de MisiÃ³n -->
    <div id="mission-briefing-screen" class="screen">
        <div class="mission-briefing-overlay">
            <div class="mission-briefing-content">
                <h2 id="briefing-title">MisiÃ³n</h2>
                <div class="briefing-narrator">
                    <p id="briefing-narrator-text"></p>
                </div>
                <div class="briefing-details">
                    <div class="briefing-stat"><span>ğŸ–ï¸ Rango:</span> <span id="briefing-rank">D</span></div>
                    <div class="briefing-stat"><span>ğŸ’° Recompensa:</span> <span id="briefing-ryo">0</span> ryos</div>
                    <div class="briefing-stat"><span>âœ¨ Experiencia:</span> <span id="briefing-exp">0</span> exp</div>
                </div>
                <div style="text-align: center; margin-top: 20px;">
                    <button class="btn" id="accept-mission-btn">âœ… Aceptar MisiÃ³n</button>
                    <button class="btn btn-secondary" id="cancel-mission-btn">âŒ Rechazar</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Pantalla Principal (Aldea) -->
    <div id="village-screen" class="screen">
        
        <!-- HEADER fijo arriba -->
        <header id="game-header">
            <button id="menu-toggle">â˜°</button>
            <div id="header-player-info">
                <span id="header-name">ğŸ‘¤ Ninja</span>
                <span id="header-ryo">ğŸ’° 0</span>
            </div>
            <div id="header-bars">
                <div class="mini-bar hp-bar"><div id="header-hp-fill"></div></div>
                <div class="mini-bar chakra-bar-mini"><div id="header-chakra-fill"></div></div>
            </div>
        </header>

        <!-- SIDEBAR OVERLAY -->
        <div id="sidebar-overlay"></div>

        <!-- SIDEBAR / MENÃš LATERAL -->
        <nav id="sidebar">
            <div class="sidebar-header">
                <h2>ğŸ¥ MenÃº</h2>
                <button class="sidebar-close" id="sidebar-close-btn">âœ•</button>
            </div>
            <div class="sidebar-nav">
                <button class="sidebar-nav-item active" data-section="home">
                    <span class="nav-icon">ğŸ </span>
                    <span>Inicio</span>
                </button>
                <button class="sidebar-nav-item" data-section="world">
                    <span class="nav-icon">ğŸ—ºï¸</span>
                    <span>Mundo</span>
                </button>
                <button class="sidebar-nav-item" data-section="inventory">
                    <span class="nav-icon">ğŸ’</span>
                    <span>Inventario</span>
                </button>
                <button class="sidebar-nav-item" data-section="shop">
                    <span class="nav-icon">ğŸª</span>
                    <span>Tienda</span>
                </button>
                <button class="sidebar-nav-item" data-section="statspage">
                    <span class="nav-icon">âš™ï¸</span>
                    <span>Stats & Config</span>
                </button>
            </div>
            <div class="sidebar-player-stats">
                <div class="stat-row">
                    <span class="stat-label">Rango</span>
                    <span class="stat-value" id="sidebar-rank">Genin</span>
                </div>
                <div class="stat-row">
                    <span class="stat-label">Nivel</span>
                    <span class="stat-value" id="sidebar-level">1</span>
                </div>
                <div class="stat-row">
                    <span class="stat-label">Ryo</span>
                    <span class="stat-value" id="sidebar-ryo">0</span>
                </div>
            </div>
            <div class="sidebar-footer">
                <button class="btn btn-secondary btn-small" onclick="game.saveGame(); game.closeSidebar();">ğŸ’¾ Guardar</button>
            </div>
        </nav>

        <!-- MAIN: contenedor de secciones -->
        <main id="game-main">

            <!-- MODAL DE CONFIRMACIÃ“N DE MISIÃ“N -->
            <div id="mission-confirm-modal" class="modal-overlay" style="display: none; z-index:99999;">
                <div class="modal-content">
                    <h3 id="mission-confirm-title">ğŸ“œ MisiÃ³n</h3>
                    <p id="mission-confirm-description"></p>
                    <div class="mission-confirm-stats">
                        <div class="stat-item">
                            <span>ğŸ–ï¸ Rango:</span>
                            <span id="mission-confirm-rank">D</span>
                        </div>
                        <div class="stat-item">
                            <span>ğŸ’° Recompensa:</span>
                            <span id="mission-confirm-ryo">0 Ryo</span>
                        </div>
                        <div class="stat-item">
                            <span>âœ¨ Experiencia:</span>
                            <span id="mission-confirm-exp">0 EXP</span>
                        </div>
                    </div>
                    <div class="modal-actions">
                        <button class="btn" id="mission-confirm-accept">âœ… Aceptar MisiÃ³n</button>
                        <button class="btn btn-secondary" id="mission-confirm-reject">âŒ Rechazar</button>
                    </div>
                </div>
            </div>

            <!-- ğŸ  SECCIÃ“N INICIO -->
            <div id="section-home" class="section-content active">
                <div class="player-info">
                    <h2 id="player-name-village">Ninja</h2>
                    <div class="player-info-clan" id="player-clan-village"></div>
                    <div class="stats-grid" style="margin-top:12px;">
                        <div class="stat-item"><span>ğŸ–ï¸ Rango:</span> <span id="player-rank">Genin</span></div>
                        <div class="stat-item"><span>â­ Nivel:</span> <span id="player-level-village">1</span></div>
                        <div class="stat-item"><span>ğŸ’° Ryo:</span> <span id="player-ryo">0</span></div>
                        <div class="stat-item"><span>âœ¨ EXP:</span> <span id="player-exp-village">0/100</span></div>
                    </div>
                    <div class="player-bars" style="margin-top:12px;">
                        <div>
                            <div style="display:flex;justify-content:space-between;margin-bottom:4px;">
                                <span>â¤ï¸ HP</span>
                                <span id="village-health-text">100/100</span>
                            </div>
                            <div class="bar-container">
                                <div class="health-fill" id="village-health-bar" style="width:100%"></div>
                            </div>
                        </div>
                        <div style="margin-top:8px;">
                            <div style="display:flex;justify-content:space-between;margin-bottom:4px;">
                                <span>ğŸ’™ Chakra</span>
                                <span id="village-chakra-text">100/100</span>
                            </div>
                            <div class="bar-container">
                                <div class="chakra-fill" id="village-chakra-bar" style="width:100%"></div>
                            </div>
                        </div>
                    </div>
                    <div id="kekkei-display" style="margin-top:12px;"></div>
                    <div id="element-display" style="margin-top:8px;"></div>
                    <div id="village-info" style="margin-top:8px;"></div>
                    <div style="margin-top:12px;">
                        <div style="display:flex;justify-content:space-between;">
                            <span>ğŸ§‘â€ğŸ¤â€ğŸ§‘ Jugadores online: <span id="village-online-count">0</span></span>
                        </div>
                        <div id="village-online-list" style="margin-top:8px;"></div>
                    </div>
                </div>
                <!-- ...existing code... -->
            </div>

                            <button id="modal-prompt-ok" class="btn" style="min-width:120px;">Aceptar</button>
                            <button id="modal-prompt-cancel" class="btn btn-secondary" style="min-width:120px;">Cancelar</button>
                        </div>
                    </div>
                </div>
                <div class="mission-list" id="mission-list"></div>
            </div>

            <div id="npcs-tab" class="tab-content">
                <h3>ğŸ§‘â€ğŸ¤â€ğŸ§‘ NPCs</h3>
                <p style="margin: 10px 0;">Conoce personajes, mejora relaciones, recibe misiones y entrenamientos Ãºnicos.</p>
                <div id="npc-list" class="npc-list"></div>

                <div id="npc-modal" class="npc-modal" style="display:none;"></div>
            </div>
        </div>

        <!-- ğŸ—ºï¸ SECCIÃ“N MUNDO (Misiones y NPCs) -->
        <div id="section-world" class="section-content">
            <div id="world-hud-display"></div>
            <div class="tabs" style="display:flex; gap:8px; margin-bottom:16px; border-bottom:1px solid var(--border-color); padding-bottom:8px;">
                <button class="tab-btn active" onclick="game.activateVillageTab('missions')">ğŸ“œ Misiones</button>
                <button class="tab-btn" onclick="game.activateVillageTab('npcs')">ğŸ‘¥ NPCs</button>
            </div>
            <div id="missions-content">
                <div class="mission-list" id="mission-list"></div>
            </div>
            <div id="npcs-content" style="display:none;">
                <div id="npc-list" class="npc-list"></div>
                <div id="npc-modal" class="npc-modal" style="display:none;"></div>
            </div>
        </div>

        <!-- ğŸ’ SECCIÃ“N INVENTARIO/ACADEMIA -->
        <div id="section-inventory" class="section-content">
            <h3>ğŸ’ Academia & Entrenamiento</h3>

            <div id="academy-tab">
            <div class="academy-header">
                <h3>ğŸ“ Academia Ninja</h3>
                <p>Aprende nuevos jutsus pagando con Ryo. Los jutsus mÃ¡s poderosos requieren un rango ninja mÃ¡s alto.</p>
            </div>
            
            <!-- SECCIÃ“N: JUTSUS POR RANGO -->
            <div class="academy-section">
                <div class="section-title">
                    <span class="section-icon">ğŸ“Š</span>
                    <h4>Jutsus por Rango</h4>
                </div>
                <div class="tabs tabs-inline">
                    <button class="tab-btn active" onclick="game.showJutsuRank('genin')">Genin</button>
                    <button class="tab-btn" onclick="game.showJutsuRank('chunin')">Chunin</button>
                    <button class="tab-btn" onclick="game.showJutsuRank('jonin')">Jonin</button>
                    <button class="tab-btn" onclick="game.showJutsuRank('master')">Maestros</button>
                </div>
            </div>

            <!-- SECCIÃ“N: ESPECIALIDADES -->
            <div class="academy-section">
                <div class="section-title">
                    <span class="section-icon">âš”ï¸</span>
                    <h4>Especialidades</h4>
                </div>
                <div class="tabs tabs-inline">
                    <button class="tab-btn" onclick="game.showJutsuRank('taijutsu')">ğŸ¥‹ Taijutsu</button>
                    <button class="tab-btn" onclick="game.showJutsuRank('genjutsu')">ğŸ­ Genjutsu</button>
                    <button class="tab-btn" onclick="game.showJutsuRank('escape')">ğŸƒ Escape</button>
                </div>
            </div>

            <!-- SECCIÃ“N: ELEMENTOS -->
            <div class="academy-section">
                <div class="section-title">
                    <span class="section-icon">ğŸŒ€</span>
                    <h4>Elementos Chakra</h4>
                </div>
                <div class="tabs tabs-inline">
                    <button class="tab-btn" onclick="game.showJutsuRank('katon')"><img src="img/fuego.png" alt="Katon" class="icon-elemento" style="height:1.2em;vertical-align:middle;"> Katon</button>
                    <button class="tab-btn" onclick="game.showJutsuRank('futon')"><img src="img/aire.png" alt="Futon" class="icon-elemento" style="height:1.2em;vertical-align:middle;"> Futon</button>
                    <button class="tab-btn" onclick="game.showJutsuRank('doton')"><img src="img/tierra.png" alt="Doton" class="icon-elemento" style="height:1.2em;vertical-align:middle;"> Doton</button>
                    <button class="tab-btn" onclick="game.showJutsuRank('raiton')"><img src="img/rayo.png" alt="Raiton" class="icon-elemento" style="height:1.2em;vertical-align:middle;"> Raiton</button>
                </div>
            </div>

            <!-- SECCIÃ“N: KEKKEI GENKAI -->
            <div class="academy-section">
                <div class="section-title">
                    <span class="section-icon">âœ¨</span>
                    <h4>Kekkei Genkai</h4>
                </div>
                <div class="tabs tabs-inline">
                    <button class="tab-btn" onclick="game.showJutsuRank('sharingan')">ğŸ‘ï¸ Sharingan</button>
                    <button class="tab-btn" onclick="game.showJutsuRank('byakugan')">ğŸ”® Byakugan</button>
                    <button class="tab-btn" onclick="game.showJutsuRank('rinnegan')">ğŸŒ€ Rinnegan</button>
                    <button class="tab-btn" onclick="game.showJutsuRank('bijuu')">ğŸ¦Š Bijuu</button>
                </div>
            </div>

            <div class="academy-jutsus-container">
                <div class="jutsu-academy-list" id="academy-jutsu-list"></div>
            </div>

            <div style="margin-top: 30px; padding-top: 20px; border-top: 2px solid rgba(255,140,0,0.3);">
                <h3 style="color: #ff8c00; margin-bottom: 15px;">ğŸ’ª Centro de Entrenamiento</h3>
                <div class="shop-grid" id="training-list"></div>
            </div>
            </div>
        </div>

        <!-- ğŸª SECCIÃ“N TIENDA -->
        <div id="section-shop" class="section-content">
            <h3>ğŸª Tienda de la Aldea</h3>
            <div style="text-align: center; margin-bottom: 15px;">
                <span style="font-size: 1.2em;">ğŸ’° Tus Ryo: <span id="shop-ryo-display" style="color: var(--accent-gold);">0</span></span>
            </div>
            <div class="shop-grid" id="shop-list">
                <p style="color: white; grid-column: 1/-1; text-align: center;">Cargando tienda...</p>
            </div>
        </div>

        <!-- âš™ï¸ SECCIÃ“N STATS -->
        <div id="section-statspage" class="section-content">
            <h3>ğŸ“Š EstadÃ­sticas & ConfiguraciÃ³n</h3>
            <div id="stats-display">
                <p style="color: white; text-align: center;">Cargando estadÃ­sticas...</p>
            </div>
        </div>
        </main>
    </div>

    <!-- BARRA DE NAVEGACIÃ“N INFERIOR (siempre visible excepto en combate) -->
    <nav id="bottom-nav">
        <button class="nav-btn active" data-tab="home">ğŸ <span>Inicio</span></button>
        <button class="nav-btn" data-tab="world">ğŸ—ºï¸<span>Mundo</span></button>
        <button class="nav-btn" data-tab="inventory">ğŸ’<span>Inventario</span></button>
        <button class="nav-btn" data-tab="shop">ğŸª<span>Tienda</span></button>
        <button class="nav-btn" data-tab="statspage">âš™ï¸<span>Stats</span></button>
    </nav>

    <!-- Combate -->
    <div id="combat-screen" class="screen">
        <div class="player-info">
            <h3 id="combat-player-name">Tu Ninja</h3>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                <div>
                    <div class="health-bar">
                        <div class="health-fill" id="combat-player-health-bar"></div>
                        <div class="bar-text" id="combat-player-health-text">HP: 100/100</div>
                    </div>
                </div>
                <div>
                    <div class="chakra-bar">
                        <div class="chakra-fill" id="combat-player-chakra-bar"></div>
                        <div class="bar-text" id="combat-player-chakra-text">Chakra: 100/100</div>
                    </div>
                </div>
            </div>
        </div>

        <div class="combat-area">
            <div class="enemy-info">
                <h3 id="enemy-name">Enemigo</h3>
                <div class="health-bar">
                    <div class="health-fill" id="enemy-health-bar" style="background: linear-gradient(90deg, #8b0000 0%, #660000 100%);"></div>
                    <div class="bar-text" id="enemy-health-text">HP: 50/50</div>
                </div>
                <p id="enemy-stats"></p>
            </div>

            <div class="combat-log" id="combat-log"></div>

            <div style="text-align: center; margin-top: 15px;">
                <button class="btn btn-small" onclick="game.basicAttack()" id="attack-btn">âš”ï¸ Taijutsu</button>
                <button class="btn btn-small" onclick="game.toggleJutsuMenu()" id="jutsu-menu-btn">ğŸŒ€ Ninjutsu</button>
                <button class="btn btn-small" onclick="game.useGenjutsu()" id="genjutsu-btn">ğŸ‘ï¸ Genjutsu</button>
                <button class="btn btn-small" onclick="game.defend()" id="defend-btn">ğŸ›¡ï¸ Defender</button>
                <button class="btn btn-small" onclick="game.useKawarimi()" id="kawarimi-btn">ğŸ’¨ Kawarimi</button>
                <button class="btn btn-small" onclick="game.showInventoryInCombat()" id="item-btn">ğŸ’ Items</button>
            </div>

            <div id="jutsu-selection" style="display: none; margin-top: 15px;">
                <h4 style="color: #3498db;">Selecciona un Jutsu:</h4>
                <div class="jutsu-quick-bar">
                    <div class="jutsu-quick-header">
                        <span>âš¡ Accesos rapidos (5)</span>
                        <span id="quick-jutsu-hint">Selecciona un slot y asigna abajo</span>
                    </div>
                    <div id="quick-jutsu-slots" class="jutsu-quick-slots"></div>
                </div>
                <div class="jutsu-grid" id="jutsu-list"></div>
            </div>

            <div id="combat-inventory" style="display: none; margin-top: 15px;">
                <h4 style="color: #2ecc71;">Items Disponibles:</h4>
                <div id="combat-items-list"></div>
            </div>
        </div>
    </div>

    <!-- Victoria de MisiÃ³n -->
    <div id="mission-victory-screen" class="screen">
        <div class="victory">
            <h2>ğŸ‰ Â¡MISIÃ“N COMPLETADA! ğŸ‰</h2>
            <p id="mission-victory-text"></p>
            <div id="kekkei-exp-gain" style="margin-top: 15px;"></div>
            <button id="return-to-village-btn" class="btn">Regresar a la Aldea</button>
        </div>
    </div>

    <!-- Derrota -->
    <div id="defeat-screen" class="screen">
        <div class="defeat">
            <h2>ğŸ’€ HAS CAÃDO EN BATALLA ğŸ’€</h2>
            <p>El camino del ninja es difÃ­cil...</p>
            <p style="margin-top: 15px;">Tu personaje ha muerto. Debes crear uno nuevo.</p>
            <button id="delete-character-btn" class="btn">Crear Nuevo Personaje</button>
        </div>
    </div>

    <!-- ExÃ¡menes -->
    <div id="exam-screen" class="screen">
        <div class="player-info" style="border-color: rgba(255, 215, 0, 0.55);">
            <h2 style="color:#ffd700;">ğŸ¯ Examen Ninja</h2>
            <div id="exam-content"></div>
            <div style="text-align:center; margin-top: 14px;">
                <button id="abandon-exam-btn" class="btn btn-secondary">Abandonar</button>
            </div>
        </div>
    </div>

    <!-- Modal de Victoria (por encima de todo) -->
    <div id="combat-victory-modal" class="modal-overlay" style="display: none; z-index: 99999;">
        <div class="modal-content" style="text-align: center;">
            <h2 style="color: #00ff88;">ğŸ‰ Â¡VICTORIA! ğŸ‰</h2>
            <p id="combat-victory-text" style="margin: 20px 0; font-size: 1.1em;"></p>
            <div id="combat-victory-rewards" style="margin: 15px 0;"></div>
            <div id="combat-kekkei-exp-gain" style="margin: 15px 0;"></div>
            <button id="combat-victory-return-btn" class="btn">Regresar a la Aldea</button>
        </div>
    </div>

    <!-- Modal de Derrota (por encima de todo) -->
    <div id="combat-defeat-modal" class="modal-overlay" style="display: none; z-index: 99999;">
        <div class="modal-content" style="text-align: center;">
            <h2 style="color: #ff4444;">ğŸ’€ DERROTA ğŸ’€</h2>
            <p id="combat-defeat-text" style="margin: 20px 0; font-size: 1.1em;">Has caÃ­do en batalla...</p>
            <button id="combat-defeat-return-btn" class="btn">Regresar a la Aldea</button>
        </div>
    </div>



<!-- Script de navegaciÃ³n (NO mÃ³dulo, carga antes que main.js) -->
<script>
    // Funciones globales de navegaciÃ³n que esperan a que game estÃ© listo
    function safeShowSection(name) {
        if (typeof game !== 'undefined' && game.showSection) {
            game.showSection(name);
        } else {
            console.warn('Game not ready yet, retrying...');
            setTimeout(() => safeShowSection(name), 100);
        }
    }
    
    // Configurar event listeners cuando el DOM estÃ© listo
    document.addEventListener('DOMContentLoaded', function() {
        // Bottom nav buttons
        document.querySelectorAll('#bottom-nav .nav-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                const tab = this.getAttribute('data-tab');
                safeShowSection(tab);
            });
        });
        
        // Sidebar nav buttons
        document.querySelectorAll('#sidebar .sidebar-nav-item').forEach(btn => {
            btn.addEventListener('click', function() {
                const section = this.getAttribute('data-section');
                if (typeof game !== 'undefined') {
                    game.navigateFromSidebar(section);
                } else {
                    safeShowSection(section);
                }
            });
        });
        
        // Sidebar close button
        const closeBtn = document.getElementById('sidebar-close-btn');
        if (closeBtn) {
            closeBtn.addEventListener('click', function() {
                if (typeof game !== 'undefined' && game.closeSidebar) {
                    game.closeSidebar();
                } else {
                    document.getElementById('sidebar').classList.remove('open');
                }
            });
        }
        
        // Menu toggle button
        const menuToggle = document.getElementById('menu-toggle');
        if (menuToggle) {
            menuToggle.addEventListener('click', function() {
                if (typeof game !== 'undefined' && game.toggleSidebar) {
                    game.toggleSidebar();
                } else {
                    document.getElementById('sidebar').classList.toggle('open');
                }
            });
        }
        
        // Sidebar overlay
        const overlay = document.getElementById('sidebar-overlay');
        if (overlay) {
            overlay.addEventListener('click', function() {
                if (typeof game !== 'undefined' && game.closeSidebar) {
                    game.closeSidebar();
                } else {
                    document.getElementById('sidebar').classList.remove('open');
                }
            });
        }
        
        // Mission briefing buttons
        const acceptMissionBtn = document.getElementById('accept-mission-btn');
        const cancelMissionBtn = document.getElementById('cancel-mission-btn');
        
        if (acceptMissionBtn) {
            acceptMissionBtn.addEventListener('click', function() {
                if (typeof game !== 'undefined' && game.acceptMissionFromBriefing) {
                    game.acceptMissionFromBriefing();
                }
            });
        }
        
        if (cancelMissionBtn) {
            cancelMissionBtn.addEventListener('click', function() {
                if (typeof game !== 'undefined' && game.cancelMissionBriefing) {
                    game.cancelMissionBriefing();
                }
            });
        }
        
        // Mission confirm modal buttons
        const acceptModalBtn = document.getElementById('mission-confirm-accept');
        const rejectModalBtn = document.getElementById('mission-confirm-reject');
        
        if (acceptModalBtn) {
            acceptModalBtn.addEventListener('click', function() {
                if (typeof game !== 'undefined' && game.acceptMissionFromModal) {
                    game.acceptMissionFromModal();
                }
            });
        }
        
        if (rejectModalBtn) {
            rejectModalBtn.addEventListener('click', function() {
                if (typeof game !== 'undefined' && game.rejectMissionFromModal) {
                    game.rejectMissionFromModal();
                }
            });
        }
        
        // Wake up button
        const wakeUpBtn = document.getElementById('wake-up-btn');
        if (wakeUpBtn) {
            wakeUpBtn.addEventListener('click', function() {
                if (typeof game !== 'undefined' && game.wakeUp) {
                    game.wakeUp();
                }
            });
        }
        
        // Return to village button (victory screen)
        const returnToVillageBtn = document.getElementById('return-to-village-btn');
        if (returnToVillageBtn) {
            returnToVillageBtn.addEventListener('click', function() {
                if (typeof game !== 'undefined' && game.returnToVillage) {
                    game.returnToVillage();
                }
            });
        }
        
        // Delete character button (defeat screen)
        const deleteCharacterBtn = document.getElementById('delete-character-btn');
        if (deleteCharacterBtn) {
            deleteCharacterBtn.addEventListener('click', function() {
                if (typeof game !== 'undefined' && game.deleteCharacterAndRestart) {
                    game.deleteCharacterAndRestart();
                }
            });
        }
        
        // Abandon exam button (exam screen)
        const abandonExamBtn = document.getElementById('abandon-exam-btn');
        if (abandonExamBtn) {
            abandonExamBtn.addEventListener('click', function() {
                if (typeof game !== 'undefined' && game.abandonExam) {
                    game.abandonExam();
                }
            });
        }
        
        // Combat victory modal return button
        const combatVictoryReturnBtn = document.getElementById('combat-victory-return-btn');
        if (combatVictoryReturnBtn) {
            combatVictoryReturnBtn.addEventListener('click', function() {
                if (typeof game !== 'undefined' && game.returnToVillageFromCombat) {
                    game.returnToVillageFromCombat();
                }
            });
        }
        
        // Combat defeat modal return button
        const combatDefeatReturnBtn = document.getElementById('combat-defeat-return-btn');
        if (combatDefeatReturnBtn) {
            combatDefeatReturnBtn.addEventListener('click', function() {
                if (typeof game !== 'undefined' && game.returnToVillageFromCombat) {
                    game.returnToVillageFromCombat();
                }
            });
        }
    });
</script>

<script type="module" src="js/main.js"></script>
</body>
</html>